<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notion Mission Control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,300;12..96,400;12..96,600;12..96,700&family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --bg: #191919;
        --bg-2: #202020;
        --bg-3: #262626;
        --bg-4: #2d2d2d;
        --border: #333333;
        --border-l: #3e3e3e;
        --white: #ffffff;
        --text-1: #ebebeb;
        --text-2: #9b9b9b;
        --text-3: #5a5a5a;
        --accent: #5c9eff;
        --healthy: #4bc48a;
        --stale: #e5a63a;
        --error: #eb5757;
        --sidebar-w: 240px;
        --chat-w: 48px;
        --chat-open: 340px;
        --font-head: "Bricolage Grotesque", sans-serif;
        --font-body: "Bricolage Grotesque", sans-serif;
        --font-mono: "JetBrains Mono", monospace;
        --radius: 8px;
      }

      html,
      body {
        height: 100%;
        background: var(--bg);
        color: var(--text-1);
        font-family: var(--font-head);
        overflow: hidden;
      }

      /* grid overlay removed â€” clean Notion-style bg */

      /* â”€â”€ APP SHELL â”€â”€ */
      .app {
        position: fixed;
        inset: 0;
        display: flex;
        z-index: 1;
      }

      /* â”€â”€ SIDEBAR â”€â”€ */
      .sidebar {
        width: var(--sidebar-w);
        flex-shrink: 0;
        background: var(--bg-2);
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        z-index: 100;
      }
      .sidebar-logo {
        padding: 20px 16px 16px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .logo-mark {
        font-size: 20px;
      }
      .logo-text {
        font-size: 14px;
        font-weight: 700;
        letter-spacing: -0.3px;
      }
      .logo-sub {
        font-size: 10px;
        color: var(--text-3);
        margin-top: 1px;
        font-weight: 400;
      }

      .sidebar-ws {
        margin: 12px 12px 0;
        padding: 8px 10px;
        background: var(--bg-3);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        font-size: 11px;
        color: var(--text-2);
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .ws-dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--healthy);
        flex-shrink: 0;
      }

      .sidebar-nav {
        flex: 1;
        padding: 14px 10px;
        display: flex;
        flex-direction: column;
        gap: 1px;
        overflow-y: auto;
      }
      .nav-section-label {
        font-size: 11px;
        font-weight: 600;
        color: var(--text-3);
        text-transform: uppercase;
        letter-spacing: 0.04em;
        padding: 12px 8px 6px;
        margin-top: 4px;
      }
      .nav-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 7px 10px;
        border-radius: var(--radius);
        cursor: pointer;
        font-size: 13px;
        color: var(--text-2);
        transition:
          background 0.12s,
          color 0.12s;
      }
      .nav-item:hover {
        background: rgba(255, 255, 255, 0.04);
        color: var(--text-1);
      }
      .nav-item.active {
        background: rgba(255, 255, 255, 0.06);
        color: var(--text-1);
      }
      .nav-item .ni {
        font-size: 15px;
        width: 20px;
        text-align: center;
        opacity: 0.8;
      }
      .nav-item .nl {
        font-size: 13px;
        font-weight: 500;
      }
      .nav-item .nb {
        margin-left: auto;
        font-family: var(--font-mono);
        font-size: 9px;
        color: var(--text-3);
        background: var(--bg-4);
        border-radius: 4px;
        padding: 2px 6px;
      }

      .sidebar-footer {
        padding: 14px 12px;
        border-top: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .sync-indicator {
        display: flex;
        align-items: center;
        gap: 6px;
        flex: 1;
      }
      .sync-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--text-3);
      }
      .sync-dot.ok {
        background: var(--healthy);
      }
      .sync-txt {
        font-size: 10px;
        color: var(--text-3);
      }
      .btn-sm {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 5px 12px;
        background: transparent;
        cursor: pointer;
        transition:
          border-color 0.15s,
          color 0.15s;
        white-space: nowrap;
      }
      .btn-sm:hover {
        border-color: var(--text-2);
        color: var(--text-1);
      }

      /* â”€â”€ CONTENT AREA â”€â”€ */
      .content-wrap {
        flex: 1;
        display: flex;
        overflow: hidden;
        position: relative;
      }

      /* â”€â”€ PAGES â”€â”€ */
      .page {
        display: none;
        flex-direction: column;
        flex: 1;
        overflow-y: auto;
        padding: 32px calc(32px + var(--chat-w)) 48px 32px;
        scrollbar-width: thin;
        scrollbar-color: var(--bg-3) transparent;
        position: relative;
        z-index: 0; /* keep pages below chat-panel z-index:50 */
      }
      .page.active {
        display: flex;
      }

      /* â”€â”€ PAGE HEADER â”€â”€ */
      .page-header {
        margin-bottom: 32px;
      }
      .page-title {
        font-size: 30px;
        font-weight: 700;
        color: var(--text-1);
        letter-spacing: -0.6px;
        line-height: 1.15;
      }
      .page-sub {
        font-size: 13px;
        color: var(--text-3);
        margin-top: 5px;
        font-weight: 400;
      }

      /* â”€â”€ WIDGET BAR â”€â”€ */
      .widget-bar {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 32px;
        padding: 18px;
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        position: relative;
      }
      .widget-bar-label {
        position: absolute;
        top: -9px;
        left: 12px;
        font-size: 10px;
        font-weight: 600;
        color: var(--text-3);
        background: var(--bg-2);
        padding: 0 6px;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }
      .widget {
        background: var(--bg-3);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 14px 18px;
        display: flex;
        flex-direction: column;
        gap: 3px;
        min-width: 130px;
        cursor: default;
        transition: border-color 0.15s;
        position: relative;
      }
      .widget:hover {
        border-color: var(--border-l);
      }
      .widget .w-close {
        position: absolute;
        top: 5px;
        right: 7px;
        font-size: 11px;
        color: var(--text-3);
        cursor: pointer;
        display: none;
      }
      .widget:hover .w-close {
        display: block;
      }
      .widget .w-close:hover {
        color: var(--text-1);
      }
      .w-label {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-3);
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }
      .w-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-1);
        line-height: 1.1;
      }
      .w-sub {
        font-size: 11px;
        color: var(--text-2);
      }
      .widget-add-btn {
        border: 1px dashed var(--border);
        border-radius: var(--radius);
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        color: var(--text-3);
        cursor: pointer;
        transition:
          border-color 0.15s,
          color 0.15s;
        white-space: nowrap;
        background: transparent;
      }
      .widget-add-btn:hover {
        border-color: var(--text-2);
        color: var(--text-2);
      }

      /* â”€â”€ MID ROW â”€â”€ */
      .mid-row {
        display: grid;
        grid-template-columns: 60fr 40fr;
        gap: 20px;
      }

      /* â”€â”€ SECTION HEADERS â”€â”€ */
      .section-head {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 16px;
      }
      .section-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-1);
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }
      .section-count {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-3);
        padding: 2px 8px;
        border: 1px solid var(--border);
        border-radius: 4px;
      }

      /* â”€â”€ PROJECT CARDS â”€â”€ */
      .projects-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
      }
      .proj-card {
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-left: 3px solid var(--border-l);
        border-radius: var(--radius);
        padding: 16px 18px;
        cursor: pointer;
        transition:
          border-color 0.15s,
          background 0.15s;
      }
      .proj-card:hover {
        background: var(--bg-3);
        border-left-color: var(--text-2);
      }
      .proj-card.bw-a {
        border-left-color: var(--accent);
      }
      .proj-card.bw-b {
        border-left-color: var(--healthy);
      }
      .proj-card.bw-c {
        border-left-color: var(--stale);
      }
      .proj-card.bw-d {
        border-left-color: var(--error);
      }
      .proj-top {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
      }
      .proj-icon {
        font-size: 16px;
      }
      .proj-name {
        font-size: 14px;
        font-weight: 600;
        flex: 1;
      }
      .proj-status {
        font-size: 10px;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 4px;
        border: 1px solid;
      }
      .proj-status.active {
        color: var(--healthy);
        border-color: rgba(75, 196, 138, 0.3);
      }
      .proj-status.hold {
        color: var(--stale);
        border-color: rgba(229, 166, 58, 0.3);
      }
      .proj-status.blocked {
        color: var(--error);
        border-color: rgba(235, 87, 87, 0.3);
      }
      .proj-progress {
        margin-bottom: 8px;
      }
      .prog-bar-bg {
        background: var(--bg-3);
        border-radius: 2px;
        height: 4px;
      }
      .prog-bar-fill {
        height: 4px;
        border-radius: 2px;
        background: var(--accent);
      }
      .prog-label {
        font-size: 10px;
        font-weight: 500;
        color: var(--text-3);
        margin-top: 4px;
      }
      .proj-tasks {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .task-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: var(--text-2);
        cursor: pointer;
      }
      .task-item:hover {
        color: var(--text-1);
      }
      .task-dot {
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: var(--text-3);
        flex-shrink: 0;
      }
      .proj-updated {
        font-size: 10px;
        color: var(--text-3);
        margin-top: 8px;
      }

      /* â”€â”€ DOCS SECTION â”€â”€ */
      .docs-row {
        display: flex;
        gap: 14px;
        overflow-x: auto;
        padding-bottom: 4px;
        scrollbar-width: thin;
        scrollbar-color: var(--bg-3) transparent;
      }
      .doc-card {
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px 18px;
        min-width: 220px;
        flex-shrink: 0;
        cursor: pointer;
        transition:
          background 0.15s,
          border-color 0.15s;
      }
      .doc-card:hover {
        background: var(--bg-3);
        border-color: var(--border-l);
      }
      .doc-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-1);
        margin-bottom: 4px;
      }
      .doc-meta {
        font-size: 11px;
        color: var(--text-3);
        margin-bottom: 6px;
      }
      .doc-excerpt {
        font-size: 12px;
        color: var(--text-2);
        line-height: 1.5;
      }
      .doc-footer {
        font-size: 10px;
        color: var(--text-3);
        margin-top: 8px;
        border-top: 1px solid var(--border);
        padding-top: 6px;
      }

      /* â”€â”€ HEALTH PAGE â”€â”€ */
      .health-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 24px;
      }
      .health-ring-card {
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 24px;
        display: flex;
        align-items: center;
        gap: 20px;
      }
      .health-ring {
        width: 88px;
        height: 88px;
        border-radius: 50%;
        flex-shrink: 0;
        background: conic-gradient(var(--healthy) 0% 87%, var(--bg-3) 87% 100%);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .health-ring-inner {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: var(--bg-2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: 700;
        color: var(--text-1);
      }
      .health-meta-block {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .hm-title {
        font-size: 16px;
        font-weight: 600;
      }
      .hm-sub {
        font-size: 11px;
        color: var(--text-2);
      }

      .db-full-list {
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
      }
      .db-full-row {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        border-bottom: 1px solid var(--border);
      }
      .db-full-row:last-child {
        border-bottom: none;
      }
      .db-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
      }
      .db-dot.healthy {
        background: var(--healthy);
      }
      .db-dot.stale {
        background: var(--stale);
        border: 1px solid rgba(229, 166, 58, 0.4);
      }
      .db-dot.error {
        background: var(--error);
      }
      .db-name {
        font-size: 13px;
        color: var(--text-2);
        flex: 1;
      }
      .db-rows {
        font-size: 11px;
        color: var(--text-3);
      }
      .db-status-pill {
        font-size: 10px;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 4px;
        border: 1px solid;
      }
      .db-status-pill.healthy {
        color: var(--healthy);
        border-color: rgba(75, 196, 138, 0.3);
      }
      .db-status-pill.stale {
        color: var(--stale);
        border-color: rgba(229, 166, 58, 0.3);
      }
      .db-status-pill.error {
        color: var(--error);
        border-color: rgba(235, 87, 87, 0.3);
      }

      /* â”€â”€ SETUP CARDS â”€â”€ */
      .setup-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 14px;
      }
      .setup-card {
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .setup-card-head {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .setup-icon {
        font-size: 18px;
      }
      .setup-name {
        font-size: 14px;
        font-weight: 600;
      }
      .setup-status-badge {
        margin-left: auto;
        font-size: 10px;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 4px;
      }
      .setup-status-badge.connected {
        color: var(--healthy);
        background: rgba(75, 196, 138, 0.08);
        border: 1px solid rgba(75, 196, 138, 0.25);
      }
      .setup-status-badge.missing {
        color: var(--stale);
        background: rgba(229, 166, 58, 0.08);
        border: 1px solid rgba(229, 166, 58, 0.25);
      }
      .setup-desc {
        font-size: 12px;
        color: var(--text-2);
        line-height: 1.5;
      }
      .setup-action {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-3);
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: 6px 14px;
        background: transparent;
        cursor: pointer;
        transition:
          border-color 0.15s,
          color 0.15s;
        width: fit-content;
      }
      .setup-action:hover {
        border-color: var(--text-2);
        color: var(--text-1);
      }

      /* â”€â”€ WORKSPACES PAGE â”€â”€ */
      .notion-page-layout {
        display: grid;
        grid-template-columns: 240px 1fr;
        gap: 0;
        flex: 1;
        min-height: 0;
      }
      .notion-sidebar {
        border-right: 1px solid var(--border);
        padding: 16px 0;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--bg-3) transparent;
      }
      .notion-tree-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 16px;
        cursor: pointer;
        font-size: 13px;
        color: var(--text-2);
        border-left: 2px solid transparent;
        transition:
          background 0.1s,
          color 0.1s;
      }
      .notion-tree-item:hover {
        background: var(--bg-3);
        color: var(--text-1);
      }
      .notion-tree-item.active {
        color: var(--text-1);
        border-left-color: var(--text-1);
        background: var(--bg-3);
      }
      .notion-tree-item .ti {
        font-size: 14px;
      }
      .notion-tree-item .tl {
        flex: 1;
      }
      .notion-tree-label {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-3);
        text-transform: uppercase;
        letter-spacing: 0.04em;
        padding: 12px 16px 4px;
      }

      .notion-page-content {
        padding: 32px 40px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--bg-3) transparent;
      }
      .notion-page-icon {
        font-size: 48px;
        margin-bottom: 12px;
      }
      .notion-page-title {
        font-size: 28px;
        font-weight: 700;
        letter-spacing: -0.5px;
        margin-bottom: 4px;
      }
      .notion-page-meta {
        font-size: 11px;
        color: var(--text-3);
        margin-bottom: 28px;
      }
      .notion-block {
        margin-bottom: 8px;
        font-size: 14px;
        color: var(--text-2);
        line-height: 1.7;
      }
      .notion-block.h2 {
        font-size: 17px;
        font-weight: 600;
        color: var(--text-1);
        margin-top: 24px;
        margin-bottom: 8px;
      }
      .notion-block.h3 {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-1);
        margin-top: 16px;
        margin-bottom: 4px;
      }
      .notion-block.divider {
        border: none;
        border-top: 1px solid var(--border);
        margin: 16px 0;
      }
      .notion-callout {
        background: var(--bg-3);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 12px 16px;
        display: flex;
        gap: 10px;
        font-size: 13px;
        color: var(--text-2);
        margin-bottom: 12px;
      }
      .callout-icon {
        font-size: 16px;
        flex-shrink: 0;
      }

      /* DB LINK CARDS */
      .db-link-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
        margin-top: 12px;
      }
      .db-link-card {
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .db-link-head {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .db-link-icon {
        font-size: 18px;
      }
      .db-link-name {
        font-size: 14px;
        font-weight: 600;
        flex: 1;
      }
      .db-link-status {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 11px;
        color: var(--text-2);
      }
      .db-link-status .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--text-3);
      }
      .db-link-status .dot.linked {
        background: var(--healthy);
      }
      .db-link-rows {
        font-size: 11px;
        color: var(--text-3);
      }
      .toggle-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 4px;
      }
      .toggle-label {
        font-size: 11px;
        color: var(--text-3);
        flex: 1;
      }
      .toggle {
        width: 32px;
        height: 18px;
        border-radius: 9px;
        background: var(--bg-4);
        border: 1px solid var(--border);
        cursor: pointer;
        position: relative;
        transition: background 0.2s;
        flex-shrink: 0;
      }
      .toggle.on {
        background: var(--bg-4);
        border-color: var(--border-l);
      }
      .toggle::after {
        content: "";
        position: absolute;
        top: 2px;
        left: 2px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--text-3);
        transition:
          transform 0.2s,
          background 0.2s;
      }
      .toggle.on::after {
        transform: translateX(14px);
        background: var(--text-1);
      }
      .db-link-btn {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-3);
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: 6px 12px;
        background: transparent;
        cursor: pointer;
        transition: all 0.15s;
      }
      .db-link-btn:hover {
        border-color: var(--text-2);
        color: var(--text-1);
      }
      .db-link-btn.linked {
        color: var(--text-2);
        border-color: var(--border);
      }

      /* â”€â”€ FEATURES PAGE â”€â”€ */
      .features-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .feat-section-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-1);
        text-transform: uppercase;
        letter-spacing: 0.04em;
        margin-bottom: 12px;
      }
      .feat-card {
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 10px;
      }
      .feat-icon {
        font-size: 18px;
        flex-shrink: 0;
        padding-top: 1px;
      }
      .feat-info {
        flex: 1;
      }
      .feat-name {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 3px;
      }
      .feat-desc {
        font-size: 12px;
        color: var(--text-2);
        line-height: 1.5;
      }
      .feat-tag {
        font-size: 10px;
        font-weight: 500;
        color: var(--text-3);
        margin-top: 5px;
      }
      .feat-toggle {
        flex-shrink: 0;
      }

      .auto-card {
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 14px 16px;
        margin-bottom: 10px;
      }
      .auto-head {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 6px;
      }
      .auto-icon {
        font-size: 14px;
      }
      .auto-name {
        font-size: 13px;
        font-weight: 600;
        flex: 1;
      }
      .auto-status {
        font-size: 10px;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 4px;
        border: 1px solid;
      }
      .auto-status.running {
        color: var(--healthy);
        border-color: rgba(75, 196, 138, 0.3);
      }
      .auto-status.paused {
        color: var(--text-3);
        border-color: var(--border);
      }
      .auto-rule {
        font-size: 11px;
        color: var(--text-2);
        line-height: 1.6;
      }
      .auto-rule span {
        color: var(--text-1);
      }
      .auto-meta {
        font-size: 10px;
        color: var(--text-3);
        margin-top: 6px;
      }

      /* â”€â”€ DOCS PAGE â”€â”€ */
      .docs-page-layout {
        display: grid;
        grid-template-columns: 240px 1fr;
        gap: 0;
        flex: 1;
        min-height: 0;
      }
      .docs-tree {
        border-right: 1px solid var(--border);
        padding: 16px 0;
        overflow-y: auto;
      }
      .docs-tree-section {
        padding: 10px 16px 4px;
        font-size: 11px;
        font-weight: 500;
        color: var(--text-3);
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }
      .docs-tree-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 16px;
        cursor: pointer;
        font-size: 13px;
        color: var(--text-2);
        border-left: 2px solid transparent;
        transition: all 0.1s;
      }
      .docs-tree-item:hover {
        background: var(--bg-3);
        color: var(--text-1);
      }
      .docs-tree-item.active {
        color: var(--text-1);
        border-left-color: var(--text-1);
        background: var(--bg-3);
      }
      .docs-tree-item.sub {
        padding-left: 28px;
        font-size: 12px;
      }
      .docs-content {
        padding: 32px 40px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--bg-3) transparent;
      }
      .docs-doc-title {
        font-size: 24px;
        font-weight: 700;
        letter-spacing: -0.5px;
        margin-bottom: 4px;
      }
      .docs-doc-meta {
        font-size: 11px;
        color: var(--text-3);
        margin-bottom: 24px;
        display: flex;
        gap: 16px;
      }
      .docs-body p {
        font-size: 14px;
        color: var(--text-2);
        line-height: 1.8;
        margin-bottom: 16px;
      }
      .docs-body h3 {
        font-size: 15px;
        font-weight: 600;
        color: var(--text-1);
        margin: 20px 0 8px;
      }
      .docs-body code {
        font-family: var(--font-mono);
        font-size: 12px;
        background: var(--bg-3);
        border: 1px solid var(--border);
        border-radius: 3px;
        padding: 1px 6px;
        color: var(--text-1);
      }
      .docs-body pre {
        font-family: var(--font-mono);
        font-size: 12px;
        background: var(--bg-3);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 14px 16px;
        color: var(--text-2);
        overflow-x: auto;
        margin-bottom: 16px;
      }

      /* =============================================
   TULSBOT EMBEDDED PAGE
   ============================================= */
      #page-tulsbot {
        padding: 0 !important;
        margin-right: var(--chat-w);
        background: var(--bg);
        overflow: hidden;
      }
      .tulsbot-frame {
        width: 100%;
        height: 100%;
        border: none;
        background: var(--bg);
      }

      /* â”€â”€ CHAT PANEL â”€â”€ */
      .chat-panel {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: var(--chat-w);
        background: var(--bg-2);
        border-left: 1px solid var(--border);
        display: flex;
        flex-direction: row;
        transition: width 0.3s ease;
        z-index: 50;
        overflow: hidden;
      }
      .chat-panel.open {
        width: var(--chat-open);
      }
      .chat-tab {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: var(--chat-w);
        min-width: var(--chat-w);
        align-self: stretch;
        cursor: pointer;
        gap: 8px;
        flex-shrink: 0;
        transition: background 0.15s;
      }
      .chat-tab:hover {
        background: var(--bg-3);
      }
      .chat-tab-icon {
        font-size: 18px;
      }
      .chat-tab-label {
        font-size: 10px;
        font-weight: 500;
        color: var(--text-2);
        writing-mode: vertical-rl;
        text-orientation: mixed;
        letter-spacing: 0.04em;
      }
      .chat-body {
        flex: 1;
        display: none;
        flex-direction: column;
        min-width: 0;
        overflow: hidden;
      }
      .chat-panel.open .chat-body {
        display: flex;
      }
      .chat-header {
        padding: 16px 18px 12px;
        border-bottom: 1px solid var(--border);
      }
      .chat-context-label {
        font-size: 10px;
        font-weight: 500;
        color: var(--text-3);
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }
      .chat-context-name {
        font-size: 13px;
        font-weight: 600;
        color: var(--text-1);
        margin-top: 2px;
      }
      .chat-hint {
        font-size: 11px;
        color: var(--text-3);
        margin-top: 4px;
      }
      .chat-close {
        float: right;
        font-size: 16px;
        color: var(--text-3);
        cursor: pointer;
        line-height: 1;
        margin-top: -20px;
      }
      .chat-close:hover {
        color: var(--text-1);
      }
      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 14px 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        scrollbar-width: thin;
        scrollbar-color: var(--bg-3) transparent;
      }
      .chat-prompts {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 0 16px 14px;
      }
      .prompt-chip {
        font-size: 12px;
        color: var(--text-2);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 9px 14px;
        cursor: pointer;
        transition: all 0.15s;
        background: transparent;
      }
      .prompt-chip:hover {
        border-color: var(--border-l);
        color: var(--text-1);
        background: var(--bg-3);
      }
      .msg-bubble {
        max-width: 85%;
        padding: 10px 14px;
        border-radius: 8px;
        font-size: 13px;
        line-height: 1.6;
      }
      .msg-bubble.user {
        background: var(--accent);
        color: #fff;
        align-self: flex-end;
      }
      .msg-bubble.ai {
        background: var(--bg-3);
        color: var(--text-1);
        border: 1px solid var(--border);
        align-self: flex-start;
      }
      .chat-input-row {
        padding: 12px 14px;
        border-top: 1px solid var(--border);
        display: flex;
        gap: 10px;
      }
      .chat-input {
        flex: 1;
        background: var(--bg-3);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text-1);
        font-size: 13px;
        padding: 11px 14px;
        outline: none;
        resize: none;
        font-family: var(--font-body);
      }
      .chat-input::placeholder {
        color: var(--text-3);
      }
      .chat-input:focus {
        border-color: var(--accent);
      }
      .chat-send {
        background: var(--accent);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 0 16px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        flex-shrink: 0;
        transition: background 0.15s;
      }
      .chat-send:hover {
        background: #4a8be6;
      }

      /* â”€â”€ COMMAND PALETTE â”€â”€ */
      .chat-input-row {
        position: relative;
      }
      .cmd-palette {
        position: absolute;
        bottom: 100%;
        left: 0;
        right: 0;
        background: var(--bg-2);
        border: 1px solid var(--border);
        border-radius: var(--radius, 8px);
        max-height: 220px;
        overflow-y: auto;
        display: none;
        z-index: 10;
        margin-bottom: 4px;
        box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.25);
      }
      .cmd-palette.visible {
        display: block;
      }
      .cmd-palette-item {
        padding: 8px 14px;
        cursor: pointer;
        display: flex;
        gap: 10px;
        align-items: baseline;
        transition: background 0.1s;
      }
      .cmd-palette-item:hover,
      .cmd-palette-item.active {
        background: var(--bg-hover);
      }
      .cmd-name {
        font-weight: 600;
        color: var(--accent);
        font-size: 13px;
      }
      .cmd-desc {
        color: var(--text-3);
        font-size: 12px;
      }

      /* â”€â”€ WIDGET PICKER MODAL â”€â”€ */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        z-index: 200;
        display: none;
        align-items: center;
        justify-content: center;
      }
      .modal-backdrop.open {
        display: flex;
      }
      .modal {
        background: var(--bg-2);
        border: 1px solid var(--border-l);
        border-radius: 12px;
        padding: 28px;
        width: 440px;
        box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
      }
      .modal-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 4px;
      }
      .modal-sub {
        font-size: 12px;
        color: var(--text-3);
        margin-bottom: 22px;
        line-height: 1.5;
      }
      .modal-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .modal-item {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
        cursor: pointer;
        transition:
          border-color 0.15s,
          background 0.15s;
      }
      .modal-item:hover {
        border-color: var(--border-l);
        background: var(--bg-3);
      }
      .modal-item.added {
        border-color: var(--border);
        color: var(--text-3);
        cursor: default;
      }
      .modal-item.added .mi-name {
        color: var(--text-3);
      }
      .modal-item.added .mi-desc {
        color: var(--text-3);
      }
      .mi-name {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 4px;
      }
      .mi-desc {
        font-size: 12px;
        color: var(--text-3);
        line-height: 1.5;
      }
      .modal-footer {
        margin-top: 22px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      .modal-cancel {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-2);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 8px 18px;
        background: transparent;
        cursor: pointer;
        transition: all 0.15s;
      }
      .modal-cancel:hover {
        border-color: var(--border-l);
        color: var(--text-1);
      }

      /* =============================================
   CLAWDBOT GATEWAY PAGE
   ============================================= */
      #page-clawdbot {
        padding: 0 !important;
        margin-right: var(--chat-w);
        background: #12141a;
        overflow: hidden;
      }

      .cb-shell {
        display: flex;
        flex-direction: column;
        height: 100%;
        font-family: "Space Grotesk", sans-serif;
        color: #e4e4e7;
      }

      /* Topbar */
      .cb-topbar {
        display: flex;
        align-items: center;
        gap: 12px;
        height: 52px;
        padding: 0 20px;
        flex-shrink: 0;
        border-bottom: 1px solid #1e2130;
        background: #14161d;
      }
      .cb-topbar-logo {
        font-weight: 700;
        font-size: 15px;
        color: #ff5c5c;
        letter-spacing: -0.02em;
      }
      .cb-topbar-sep {
        width: 1px;
        height: 20px;
        background: #1e2130;
      }
      .cb-topbar-session {
        font-size: 13px;
        color: #71717a;
      }
      .cb-topbar-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #4bc48a;
        margin-left: auto;
      }
      .cb-topbar-status {
        font-size: 11px;
        color: #4bc48a;
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }

      /* Chat Area */
      .cb-chat {
        flex: 1;
        overflow-y: auto;
        padding: 24px 20px 12px;
        display: flex;
        flex-direction: column;
        gap: 0;
      }
      .cb-chat::-webkit-scrollbar {
        width: 6px;
      }
      .cb-chat::-webkit-scrollbar-thumb {
        background: #1e2130;
        border-radius: 3px;
      }

      /* Message groups (Slack-style) */
      .cb-group {
        display: flex;
        gap: 12px;
        align-items: flex-start;
        margin-bottom: 16px;
      }
      .cb-group.user {
        flex-direction: row-reverse;
      }
      .cb-group-msgs {
        display: flex;
        flex-direction: column;
        gap: 2px;
        max-width: min(720px, calc(100% - 60px));
      }
      .cb-group.user .cb-group-msgs {
        align-items: flex-end;
      }

      /* Avatars */
      .cb-avatar {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: grid;
        place-items: center;
        font-weight: 600;
        font-size: 13px;
        flex-shrink: 0;
        align-self: flex-end;
        margin-bottom: 4px;
      }
      .cb-avatar.assistant {
        background: #1a1d25;
        color: #ff5c5c;
        border: 1px solid #1e2130;
      }
      .cb-avatar.user {
        background: rgba(255, 92, 92, 0.12);
        color: #ff5c5c;
      }
      .cb-avatar.tool {
        background: #1a1d25;
        color: #14b8a6;
        border: 1px solid #1e2130;
      }

      /* Bubbles */
      .cb-bubble {
        display: inline-block;
        position: relative;
        background: #181b22;
        border: 1px solid #1e2130;
        border-radius: 12px;
        padding: 10px 14px;
        font-size: 14px;
        line-height: 1.65;
        max-width: 100%;
        word-wrap: break-word;
      }
      .cb-group.user .cb-bubble {
        background: rgba(255, 92, 92, 0.1);
        border-color: rgba(255, 92, 92, 0.18);
      }
      .cb-bubble code {
        font-family: "JetBrains Mono", monospace;
        font-size: 12px;
        background: rgba(255, 255, 255, 0.06);
        padding: 2px 5px;
        border-radius: 4px;
      }
      .cb-bubble pre {
        background: #0d0f14;
        border: 1px solid #1e2130;
        border-radius: 8px;
        padding: 12px 14px;
        overflow-x: auto;
        margin: 8px 0;
        font-size: 12px;
      }
      .cb-bubble pre code {
        background: none;
        padding: 0;
      }
      .cb-bubble strong {
        color: #fafafa;
        font-weight: 600;
      }
      .cb-bubble a {
        color: #ff5c5c;
        text-decoration: none;
      }
      .cb-bubble a:hover {
        text-decoration: underline;
      }

      /* Footer under group */
      .cb-group-footer {
        display: flex;
        gap: 8px;
        align-items: baseline;
        margin-top: 5px;
      }
      .cb-group.user .cb-group-footer {
        justify-content: flex-end;
      }
      .cb-sender {
        font-weight: 500;
        font-size: 12px;
        color: #71717a;
      }
      .cb-time {
        font-size: 11px;
        color: #52525b;
      }

      /* Tool cards */
      .cb-tool-card {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: #14161d;
        border: 1px solid #1e2130;
        border-radius: 10px;
        padding: 10px 14px;
        font-size: 13px;
        max-width: 100%;
      }
      .cb-tool-icon {
        font-size: 16px;
        flex-shrink: 0;
      }
      .cb-tool-body {
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 0;
      }
      .cb-tool-name {
        font-weight: 600;
        font-size: 12px;
        color: #14b8a6;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }
      .cb-tool-detail {
        font-size: 12px;
        color: #a1a1aa;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .cb-tool-status {
        font-size: 11px;
        color: #4bc48a;
        margin-top: 2px;
      }
      .cb-tool-status.running {
        color: #e5a63a;
      }

      /* Thinking indicator */
      .cb-thinking {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: #181b22;
        border: 1px solid #1e2130;
        border-radius: 12px;
        padding: 10px 14px;
        font-size: 13px;
        color: #71717a;
      }
      .cb-thinking-dots {
        display: flex;
        gap: 4px;
      }
      .cb-thinking-dots span {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #ff5c5c;
        opacity: 0.3;
        animation: cb-dot-pulse 1.4s infinite ease-in-out;
      }
      .cb-thinking-dots span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .cb-thinking-dots span:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes cb-dot-pulse {
        0%,
        80%,
        100% {
          opacity: 0.3;
        }
        40% {
          opacity: 1;
        }
      }

      /* Streaming border */
      .cb-bubble.streaming {
        animation: cb-stream 1.5s ease-out infinite;
      }
      @keyframes cb-stream {
        0%,
        100% {
          border-color: #1e2130;
        }
        50% {
          border-color: #ff5c5c;
        }
      }

      /* Compose Bar */
      .cb-compose {
        display: flex;
        align-items: flex-end;
        gap: 10px;
        padding: 14px 20px 18px;
        border-top: 1px solid #1e2130;
        background: #14161d;
        flex-shrink: 0;
      }
      .cb-compose-input {
        flex: 1;
        resize: none;
        border: 1px solid #1e2130;
        background: #181b22;
        color: #e4e4e7;
        font-family: "Space Grotesk", sans-serif;
        font-size: 14px;
        padding: 10px 14px;
        border-radius: 10px;
        min-height: 40px;
        max-height: 120px;
        outline: none;
        transition: border-color 0.15s;
      }
      .cb-compose-input::placeholder {
        color: #52525b;
      }
      .cb-compose-input:focus {
        border-color: #ff5c5c;
      }
      .cb-compose-send {
        width: 38px;
        height: 38px;
        border-radius: 8px;
        border: none;
        background: #ff5c5c;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
        display: grid;
        place-items: center;
        transition: background 0.15s;
        flex-shrink: 0;
      }
      .cb-compose-send:hover {
        background: #ff7070;
      }

      /* Divider */
      .cb-divider {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 14px 0;
        color: #52525b;
        font-size: 11px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
      }
      .cb-divider-line {
        flex: 1;
        height: 1px;
        background: #1e2130;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- â”€â”€ SIDEBAR â”€â”€ -->
      <aside class="sidebar">
        <div class="sidebar-logo">
          <span class="logo-mark">â—ˆ</span>
          <div>
            <div class="logo-text">Mission Control</div>
            <div class="logo-sub">Notion Workspace</div>
          </div>
        </div>
        <div class="sidebar-ws">
          <span class="ws-dot"></span>
          My Team Workspace
        </div>
        <nav class="sidebar-nav">
          <div class="nav-section-label">Overview</div>
          <div class="nav-item active" data-page="dashboard">
            <span class="ni">â¬¡</span><span class="nl">Dashboard</span>
          </div>

          <div class="nav-section-label">Workspace</div>
          <div class="nav-item" data-page="workspaces">
            <span class="ni">ðŸ—‚</span><span class="nl">Workspaces</span><span class="nb">8</span>
          </div>
          <div class="nav-item" data-page="docs">
            <span class="ni">ðŸ“„</span><span class="nl">Docs</span><span class="nb">412</span>
          </div>

          <div class="nav-section-label">System</div>
          <div class="nav-item" data-page="health">
            <span class="ni">â—Ž</span><span class="nl">Health & Setup</span>
          </div>
          <div class="nav-item" data-page="features">
            <span class="ni">âš™</span><span class="nl">Features & Automations</span>
          </div>

          <div class="nav-section-label">Apps</div>
          <div class="nav-item" data-page="clawdbot">
            <span class="ni" style="color: #ff5c5c">â¬¢</span><span class="nl">ClawdBot</span>
          </div>
          <div class="nav-item" data-page="tulsbot">
            <span class="ni" style="color: #5c9eff">â—†</span><span class="nl">Tulsbot</span>
          </div>
        </nav>
        <div class="sidebar-footer">
          <div class="sync-indicator">
            <span class="sync-dot ok"></span>
            <span class="sync-txt" id="sync-label">Synced 2m ago</span>
          </div>
          <button class="btn-sm" id="btn-sync">âŸ³</button>
        </div>
      </aside>

      <!-- â”€â”€ CONTENT WRAP â”€â”€ -->
      <div class="content-wrap">
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- PAGE: DASHBOARD                            -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="page active" id="page-dashboard">
          <div class="page-header">
            <div class="page-title">Dashboard</div>
            <div class="page-sub">
              Overview of your Notion workspace activity and project status
            </div>
          </div>

          <!-- WIDGET BAR -->
          <div class="widget-bar" id="widget-bar">
            <span class="widget-bar-label">Widgets â€” add via chat</span>
            <!-- widgets injected by JS -->
            <button class="widget-add-btn" id="widget-add-btn">ï¼‹ Add Widget</button>
          </div>

          <!-- MID ROW -->
          <div class="mid-row">
            <div>
              <div class="section-head">
                <span class="section-title">Projects & Tasks</span>
                <span class="section-count">4 active</span>
              </div>
              <div class="projects-grid" id="projects-grid"></div>
            </div>
            <div>
              <div class="section-head">
                <span class="section-title">Quick Health</span>
              </div>
              <div id="quick-health"></div>
            </div>
          </div>

          <!-- DOCS -->
          <div style="margin-top: 20px">
            <div class="section-head">
              <span class="section-title">Docs & Knowledge</span>
              <span class="section-count">412</span>
            </div>
            <div class="docs-row" id="docs-row"></div>
          </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- PAGE: HEALTH & SETUP                       -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="page" id="page-health">
          <div class="page-header">
            <div class="page-title">Health & Setup</div>
            <div class="page-sub">
              Database sync status, API configuration, and connection settings
            </div>
          </div>

          <div class="health-grid">
            <div class="health-ring-card">
              <div class="health-ring">
                <div class="health-ring-inner">87%</div>
              </div>
              <div class="health-meta-block">
                <div class="hm-title">Overall Health</div>
                <div class="hm-sub">6 healthy Â· 2 stale Â· 1 error</div>
                <div class="hm-sub" style="margin-top: 4px">Last full scan: 4m ago</div>
                <div class="hm-sub">Next sync: in 8 min</div>
              </div>
            </div>
            <div
              class="health-ring-card"
              style="flex-direction: column; align-items: flex-start; gap: 10px"
            >
              <div
                style="
                  font-size: 12px;
                  font-weight: 600;
                  text-transform: uppercase;
                  letter-spacing: 0.06em;
                  color: var(--text-2);
                "
              >
                Sync Timeline
              </div>
              <div
                style="
                  font-family: var(--font-mono);
                  font-size: 10px;
                  color: var(--text-3);
                  display: flex;
                  flex-direction: column;
                  gap: 6px;
                  width: 100%;
                "
              >
                <div>âŸ³ 14:32 UTC â€” Full workspace sync</div>
                <div>âœ“ 14:20 UTC â€” Product Roadmap (142 rows)</div>
                <div>âœ“ 14:18 UTC â€” Issue Backlog (203 rows)</div>
                <div style="color: #888">âš  14:15 UTC â€” Client Roster rate limited</div>
                <div>âœ“ 14:10 UTC â€” Research Vault (412 rows)</div>
              </div>
            </div>
          </div>

          <div class="section-head">
            <span class="section-title">Database Status</span>
            <span class="section-count">8 databases</span>
          </div>
          <div class="db-full-list" id="db-full-list"></div>

          <div class="section-head" style="margin-top: 24px">
            <span class="section-title">Setup & Configuration</span>
          </div>
          <div class="setup-grid" id="setup-grid"></div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- PAGE: WORKSPACES                           -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="page" id="page-workspaces" style="padding: 0; flex-direction: row">
          <div class="notion-page-layout" style="flex: 1; overflow: hidden">
            <div class="notion-sidebar" id="notion-sidebar"></div>
            <div class="notion-page-content" id="notion-page-content"></div>
          </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- PAGE: FEATURES & AUTOMATIONS              -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="page" id="page-features">
          <div class="page-header">
            <div class="page-title">Features & Automations</div>
            <div class="page-sub">
              Manage feature flags and configure automation rules for your workspace
            </div>
          </div>
          <div class="features-layout">
            <div>
              <div class="feat-section-title">Feature Flags</div>
              <div id="feat-list"></div>
            </div>
            <div>
              <div class="feat-section-title">Automation Rules</div>
              <div id="auto-list"></div>
            </div>
          </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- PAGE: DOCS                                 -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="page" id="page-docs" style="padding: 0; flex-direction: row">
          <div class="docs-page-layout" style="flex: 1; overflow: hidden">
            <div class="docs-tree" id="docs-tree"></div>
            <div class="docs-content" id="docs-content"></div>
          </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- PAGE: CLAWDBOT GATEWAY                     -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="page" id="page-clawdbot">
          <div class="cb-shell">
            <!-- Topbar -->
            <div class="cb-topbar">
              <div class="cb-topbar-logo">â¬¢ ClawdBot</div>
              <div class="cb-topbar-sep"></div>
              <div class="cb-topbar-session">Session #42 â€” main workspace</div>
              <div class="cb-topbar-dot"></div>
              <div class="cb-topbar-status">Connected</div>
            </div>

            <!-- Chat Thread -->
            <div class="cb-chat" id="cb-chat">
              <!-- System divider -->
              <div class="cb-divider">
                <span class="cb-divider-line"></span>
                <span>Session started Â· Today 2:34 PM</span>
                <span class="cb-divider-line"></span>
              </div>

              <!-- Assistant welcome -->
              <div class="cb-group">
                <div class="cb-avatar assistant">C</div>
                <div class="cb-group-msgs">
                  <div class="cb-bubble">
                    Hey! I'm <strong>ClawdBot</strong> â€” your AI pair programmer. I've loaded your
                    workspace context and I'm ready to help. What are we working on?
                  </div>
                  <div class="cb-group-footer">
                    <span class="cb-sender">ClawdBot</span>
                    <span class="cb-time">2:34 PM</span>
                  </div>
                </div>
              </div>

              <!-- User message -->
              <div class="cb-group user">
                <div class="cb-avatar user">T</div>
                <div class="cb-group-msgs">
                  <div class="cb-bubble">
                    Can you check the memory manager for any error recovery gaps? I want to make
                    sure we handle edge cases properly.
                  </div>
                  <div class="cb-group-footer">
                    <span class="cb-sender">You</span>
                    <span class="cb-time">2:35 PM</span>
                  </div>
                </div>
              </div>

              <!-- Tool card group -->
              <div class="cb-group">
                <div class="cb-avatar tool">âš¡</div>
                <div class="cb-group-msgs">
                  <div class="cb-tool-card">
                    <div class="cb-tool-icon">ðŸ“‚</div>
                    <div class="cb-tool-body">
                      <div class="cb-tool-name">Read File</div>
                      <div class="cb-tool-detail">src/memory/manager.ts</div>
                      <div class="cb-tool-status">âœ“ Complete â€” 247 lines</div>
                    </div>
                  </div>
                  <div class="cb-tool-card">
                    <div class="cb-tool-icon">ðŸ”</div>
                    <div class="cb-tool-body">
                      <div class="cb-tool-name">Grep</div>
                      <div class="cb-tool-detail">pattern: "catch|error|throw" in src/memory/</div>
                      <div class="cb-tool-status">âœ“ Complete â€” 12 matches</div>
                    </div>
                  </div>
                  <div class="cb-tool-card">
                    <div class="cb-tool-icon">ðŸ“‚</div>
                    <div class="cb-tool-body">
                      <div class="cb-tool-name">Read File</div>
                      <div class="cb-tool-detail">src/memory/error-recovery.test.ts</div>
                      <div class="cb-tool-status">âœ“ Complete â€” 89 lines</div>
                    </div>
                  </div>
                  <div class="cb-group-footer">
                    <span class="cb-sender">Tool Calls</span>
                    <span class="cb-time">2:35 PM</span>
                  </div>
                </div>
              </div>

              <!-- Assistant analysis -->
              <div class="cb-group">
                <div class="cb-avatar assistant">C</div>
                <div class="cb-group-msgs">
                  <div class="cb-bubble">
                    I've reviewed the memory manager and found a few gaps:
                    <br /><br />
                    <strong>1. Missing retry on corrupt namespace reads</strong> â€” if a namespace
                    file is partially written (crash during save), the read silently returns
                    <code>null</code> instead of attempting recovery. <br /><br />
                    <strong>2. No circuit breaker for cascading failures</strong> â€” when the
                    filesystem is full, every write attempt will fail and queue retries
                    indefinitely. <br /><br />
                    <strong>3. Search index rebuild not guarded</strong> â€” concurrent rebuilds can
                    corrupt the in-memory index. <br /><br />
                    Want me to implement fixes for these? I'd suggest starting with the corrupt read
                    recovery since that's the highest-impact issue.
                  </div>
                  <div class="cb-group-footer">
                    <span class="cb-sender">ClawdBot</span>
                    <span class="cb-time">2:36 PM</span>
                  </div>
                </div>
              </div>

              <!-- User reply -->
              <div class="cb-group user">
                <div class="cb-avatar user">T</div>
                <div class="cb-group-msgs">
                  <div class="cb-bubble">
                    Yes, start with #1. Show me the approach first before writing code.
                  </div>
                  <div class="cb-group-footer">
                    <span class="cb-sender">You</span>
                    <span class="cb-time">2:37 PM</span>
                  </div>
                </div>
              </div>

              <!-- Thinking indicator (live) -->
              <div class="cb-group">
                <div class="cb-avatar assistant">C</div>
                <div class="cb-group-msgs">
                  <div class="cb-thinking">
                    <div class="cb-thinking-dots"><span></span><span></span><span></span></div>
                    Analyzing recovery strategiesâ€¦
                  </div>
                </div>
              </div>
            </div>

            <!-- Compose Bar -->
            <div class="cb-compose">
              <textarea
                class="cb-compose-input"
                id="cb-input"
                rows="1"
                placeholder="Message ClawdBotâ€¦"
              ></textarea>
              <button class="cb-compose-send" id="cb-send">â†‘</button>
            </div>
          </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- PAGE: TULSBOT (EMBEDDED APP)               -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="page" id="page-tulsbot">
          <iframe class="tulsbot-frame" id="tulsbot-frame" title="Tulsbot Control"></iframe>
        </div>

        <!-- â”€â”€ CHAT PANEL â”€â”€ -->
        <div class="chat-panel" id="chat-panel">
          <div class="chat-tab" id="chat-tab">
            <span class="chat-tab-icon">ðŸ’¬</span>
            <span class="chat-tab-label">Ask</span>
          </div>
          <div class="chat-body">
            <div class="chat-header">
              <span class="chat-close" id="chat-close">â€¹</span>
              <div class="chat-context-label">Context</div>
              <div class="chat-context-name" id="chat-context-name">â—ˆ Mission Control</div>
              <div class="chat-hint" id="chat-hint">
                Type "add widget [name]" to customize dashboard
              </div>
            </div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="chat-prompts" id="chat-prompts"></div>
            <div class="chat-input-row">
              <div class="cmd-palette" id="cmd-palette"></div>
              <textarea
                class="chat-input"
                id="chat-input"
                rows="1"
                placeholder="Ask anything or type / for commands"
              ></textarea>
              <button class="chat-send" id="chat-send">â†‘</button>
            </div>
          </div>
        </div>
      </div>
      <!-- /content-wrap -->
    </div>
    <!-- /app -->

    <!-- â”€â”€ WIDGET PICKER MODAL â”€â”€ -->
    <div class="modal-backdrop" id="modal-backdrop">
      <div class="modal">
        <div class="modal-title">Add Widget</div>
        <div class="modal-sub">Select a metric to pin to your dashboard</div>
        <div class="modal-grid" id="modal-grid"></div>
        <div class="modal-footer">
          <button class="modal-cancel" id="modal-cancel">Cancel</button>
        </div>
      </div>
    </div>

    <script>
      (function () {
        "use strict";

        /* â”€â”€ HELPERS â”€â”€ */
        function el(tag, cls) {
          var e = document.createElement(tag);
          if (cls) e.className = cls;
          return e;
        }
        function txt(tag, cls, t) {
          var e = el(tag, cls);
          e.textContent = t;
          return e;
        }
        function clr(p) {
          while (p.firstChild) p.removeChild(p.firstChild);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOCK DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        var PROJECTS = [
          {
            icon: "ðŸ—º",
            name: "Product Roadmap",
            done: 18,
            total: 24,
            status: "active",
            border: "bw-a",
            tasks: [
              "Define Q4 feature priorities",
              "Review competitor analysis",
              "Finalize launch criteria",
            ],
          },
          {
            icon: "âš¡",
            name: "Engineering Sprints",
            done: 9,
            total: 13,
            status: "active",
            border: "bw-b",
            tasks: [
              "Fix auth token refresh bug",
              "Migrate DB to Postgres 15",
              "Write API docs for v2",
            ],
          },
          {
            icon: "ðŸŽ¯",
            name: "OKR Tracker",
            done: 6,
            total: 12,
            status: "hold",
            border: "bw-c",
            tasks: ["Update Q3 final scores", "Kick off Q4 OKR workshop", "Align design KRs"],
          },
          {
            icon: "ðŸ›",
            name: "Issue Backlog",
            done: 31,
            total: 47,
            status: "active",
            border: "bw-d",
            tasks: ["iOS login crash â€” P0", "Dark mode flicker on Android", "Search timeout >3s"],
          },
        ];

        var DBS = [
          { name: "Product Roadmap", rows: 142, status: "healthy" },
          { name: "Engineering Sprints", rows: 67, status: "healthy" },
          { name: "Knowledge Base", rows: 891, status: "stale" },
          { name: "OKR Tracker", rows: 48, status: "healthy" },
          { name: "Issue Backlog", rows: 203, status: "healthy" },
          { name: "Client Roster", rows: 94, status: "error" },
          { name: "Content Pipeline", rows: 156, status: "stale" },
          { name: "Research Vault", rows: 412, status: "healthy" },
        ];

        var DOCS_DATA = [
          {
            title: "Q3 Retrospective",
            source: "Research Vault",
            words: 2400,
            edited: "Today, 10:14",
            excerpt: "Key wins: shipped onboarding v2, reduced churn 8%â€¦",
          },
          {
            title: "System Architecture v3",
            source: "Knowledge Base",
            words: 5800,
            edited: "Yesterday",
            excerpt: "Monorepo migration complete. Service mesh next quarterâ€¦",
          },
          {
            title: "Brand Guidelines 2024",
            source: "Content Pipeline",
            words: 1200,
            edited: "3 days ago",
            excerpt: "Updated primary typeface to Bricolage Grotesque for allâ€¦",
          },
          {
            title: "Hiring Rubric â€” Eng",
            source: "Client Roster",
            words: 900,
            edited: "Last week",
            excerpt: "Criteria: systems design, communication, ownership mindsetâ€¦",
          },
          {
            title: "Sprint 34 Planning",
            source: "Eng Sprints",
            words: 640,
            edited: "Today, 09:02",
            excerpt: "Focus: API stability and mobile performance improvementsâ€¦",
          },
        ];

        var ALL_WIDGETS = [
          { id: "total-pages", label: "Total Pages", value: "1,673", sub: "across 8 databases" },
          { id: "open-tasks", label: "Open Tasks", value: "47", sub: "12 due this week" },
          { id: "docs", label: "Docs & Notes", value: "412", sub: "38 edited today" },
          { id: "health", label: "Workspace Health", value: "87%", sub: "1 error Â· 2 stale" },
          { id: "databases", label: "Databases", value: "8", sub: "6 healthy" },
          { id: "team", label: "Team Members", value: "14", sub: "3 active now" },
          { id: "automations", label: "Automations", value: "7", sub: "5 running" },
          { id: "synced-today", label: "Rows Synced Today", value: "2.4k", sub: "last: 2m ago" },
        ];
        var activeWidgets = ["total-pages", "open-tasks", "docs", "health"];

        var SETUP_CARDS = [
          {
            icon: "ðŸ”‘",
            name: "Notion API Key",
            status: "connected",
            desc: "Integration token connected. Read/write access to all shared databases.",
            action: "Rotate Key",
          },
          {
            icon: "ðŸ”—",
            name: "Webhook Endpoint",
            status: "connected",
            desc: "Events streaming to api.yourapp.com/notion-hook. Last event: 2m ago.",
            action: "Edit URL",
          },
          {
            icon: "â±",
            name: "Sync Interval",
            status: "connected",
            desc: "Full workspace sync every 10 minutes. Delta sync on webhook events.",
            action: "Configure",
          },
          {
            icon: "ðŸ›¡",
            name: "OAuth Scopes",
            status: "connected",
            desc: "read_content, update_content, insert_content, read_user_with_email",
            action: "Review",
          },
          {
            icon: "ðŸ“¡",
            name: "Realtime Presence",
            status: "missing",
            desc: "Enable live cursor and co-editing presence via Notion multiplayer API.",
            action: "Enable",
          },
          {
            icon: "ðŸ—„",
            name: "Mirror Storage",
            status: "missing",
            desc: "Cache database snapshots locally for offline access and faster reads.",
            action: "Set Up",
          },
        ];

        var WORKSPACE_PAGES = [
          { icon: "ðŸ ", name: "Getting Started", tag: "start" },
          { icon: "ðŸ—º", name: "Product Roadmap", tag: "roadmap" },
          { icon: "âš¡", name: "Engineering Hub", tag: "eng" },
          { icon: "ðŸ§ ", name: "Knowledge Base", tag: "kb" },
          { icon: "ðŸŽ¯", name: "OKR Tracker", tag: "okr" },
          { icon: "ðŸ‘¥", name: "Team Directory", tag: "team" },
        ];

        var FEATURES = [
          {
            icon: "ðŸ”",
            name: "Auto-sync on Edit",
            desc: "Trigger a delta sync whenever a Notion page is updated via webhook.",
            tag: "sync",
            on: true,
          },
          {
            icon: "ðŸ·",
            name: "Smart Tagging",
            desc: "Automatically tag pages with AI-generated labels based on content.",
            tag: "ai",
            on: false,
          },
          {
            icon: "ðŸ“¬",
            name: "Slack Digest",
            desc: "Send a daily summary of workspace changes to a Slack channel.",
            tag: "notify",
            on: true,
          },
          {
            icon: "ðŸ”",
            name: "Full-text Search Index",
            desc: "Maintain an Elasticsearch index for instant cross-database search.",
            tag: "search",
            on: true,
          },
          {
            icon: "ðŸ“Š",
            name: "Analytics Dashboard",
            desc: "Track page views, edits, and active contributors per database.",
            tag: "analytics",
            on: false,
          },
        ];

        var AUTOMATIONS = [
          {
            icon: "âš¡",
            name: "Stale DB Alert",
            status: "running",
            when: "database.lastSync",
            cond: "> 24h",
            then: "notify.slack + flag.stale",
            runs: "Every 6h Â· last: 4h ago",
          },
          {
            icon: "ðŸ”„",
            name: "OKR Rollup",
            status: "running",
            when: "okr.quarter",
            cond: "= Q4",
            then: "rollup.scores â†’ summary.page",
            runs: "Weekly Mon 09:00",
          },
          {
            icon: "ðŸ›",
            name: "P0 Escalation",
            status: "running",
            when: "issue.priority",
            cond: "= P0",
            then: "notify.oncall + create.incident",
            runs: "On trigger Â· 3Ã— today",
          },
          {
            icon: "ðŸ“‹",
            name: "Sprint Close",
            status: "paused",
            when: "sprint.status",
            cond: "= Done",
            then: "archive.tasks + create.retro",
            runs: "Paused â€” manual trigger",
          },
        ];

        var DOCS_TREE = [
          {
            label: "Engineering",
            items: [
              { title: "System Architecture v3", words: 5800, edited: "Yesterday", body: "arch" },
              { title: "API Reference v2", words: 3200, edited: "2 days ago", body: "api" },
              { title: "Deployment Runbook", words: 1800, edited: "Last week", body: "ops" },
            ],
          },
          {
            label: "Product",
            items: [
              { title: "Q3 Retrospective", words: 2400, edited: "Today, 10:14", body: "retro" },
              { title: "Sprint 34 Planning", words: 640, edited: "Today, 09:02", body: "sprint" },
            ],
          },
          {
            label: "Brand & Design",
            items: [
              { title: "Brand Guidelines 2024", words: 1200, edited: "3 days ago", body: "brand" },
            ],
          },
          {
            label: "People Ops",
            items: [
              { title: "Hiring Rubric â€” Eng", words: 900, edited: "Last week", body: "hiring" },
            ],
          },
        ];

        var DOCS_BODIES = {
          arch: {
            h: "System Architecture v3",
            paras: [
              "The monorepo migration is complete across all service boundaries. All inter-service calls now route through the internal service mesh with mTLS enforced at the transport layer.",
              "Database sharding has been implemented for the primary read replicas. Each tenant is isolated to a dedicated schema prefix, with connection pooling managed by PgBouncer at 25 max connections per pool.",
              "Next quarter: evaluate Temporal.io for workflow orchestration to replace the ad-hoc cron jobs in the data pipeline.",
            ],
          },
          api: {
            h: "API Reference v2",
            paras: [
              "All endpoints require Bearer authentication using a workspace-scoped token. Tokens expire after 90 days and can be rotated via the dashboard.",
              "Rate limits: 100 req/min per token for read operations, 30 req/min for write operations. Burst allowance of 20 additional requests per 10-second window.",
            ],
          },
          retro: {
            h: "Q3 Retrospective",
            paras: [
              "Key wins this quarter: shipped onboarding v2 (CSAT up 14%), reduced backend P95 latency from 420ms to 180ms, migrated 3 services to the new auth layer.",
              "What slowed us down: scope creep on the search feature, insufficient staging-to-prod parity causing surprise bugs, on-call rotation gaps in August.",
              "Action items for Q4: establish feature-flag discipline before sprint start, invest in load testing infrastructure, add a second on-call rotation slot.",
            ],
          },
          brand: {
            h: "Brand Guidelines 2024",
            paras: [
              "Primary typeface updated to Bricolage Grotesque across all marketing surfaces. Heading weight is 700, body is 400. Minimum size 13px on dark backgrounds.",
              "Monospace contexts (code, data, timestamps) use JetBrains Mono at weight 400â€“500. Never use decorative fonts in product UI.",
              "Color palette is intentionally minimal: near-black (#0a0a0a) backgrounds, white text (#f0f0f0), single accent reserved for actionable elements only.",
            ],
          },
        };

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        var currentPage = "dashboard";
        function showPage(id) {
          document.querySelectorAll(".page").forEach(function (p) {
            p.classList.remove("active");
          });
          document.querySelectorAll(".nav-item").forEach(function (n) {
            n.classList.remove("active");
          });
          var pg = document.getElementById("page-" + id);
          if (pg) pg.classList.add("active");
          var ni = document.querySelector('[data-page="' + id + '"]');
          if (ni) ni.classList.add("active");
          currentPage = id;

          if (id === "workspaces") renderWorkspacePage(WORKSPACE_PAGES[0]);
          if (id === "docs") renderDocPage(DOCS_TREE[0].items[0]);
          if (id === "clawdbot") {
            var chat = document.getElementById("cb-chat");
            if (chat) chat.scrollTop = chat.scrollHeight;
          }

          /* Update chat context label + prompts for new page */
          var ctxName = PAGE_CONTEXT_NAMES[id];
          if (ctxName) setContext(ctxName);
          buildPrompts();
        }
        document.querySelectorAll(".nav-item").forEach(function (n) {
          n.addEventListener("click", function () {
            showPage(n.dataset.page);
          });
        });

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIDGET BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildWidgets() {
          var bar = document.getElementById("widget-bar");
          var addBtn = document.getElementById("widget-add-btn");
          // remove existing widgets
          var old = bar.querySelectorAll(".widget");
          old.forEach(function (w) {
            bar.removeChild(w);
          });

          activeWidgets.forEach(function (wid) {
            var data = ALL_WIDGETS.find(function (w) {
              return w.id === wid;
            });
            if (!data) return;
            var w = el("div", "widget");
            w.dataset.wid = wid;
            w.appendChild(txt("div", "w-label", data.label));
            w.appendChild(txt("div", "w-value", data.value));
            w.appendChild(txt("div", "w-sub", data.sub));
            var close = txt("span", "w-close", "Ã—");
            close.addEventListener("click", function () {
              removeWidget(wid);
            });
            w.appendChild(close);
            bar.insertBefore(w, addBtn);
          });
        }

        function addWidget(id) {
          if (activeWidgets.indexOf(id) === -1) {
            activeWidgets.push(id);
            buildWidgets();
          }
        }
        function removeWidget(id) {
          activeWidgets = activeWidgets.filter(function (w) {
            return w !== id;
          });
          buildWidgets();
        }

        /* Widget picker modal */
        document.getElementById("widget-add-btn").addEventListener("click", openModal);
        document.getElementById("modal-cancel").addEventListener("click", closeModal);
        document.getElementById("modal-backdrop").addEventListener("click", function (e) {
          if (e.target === this) closeModal();
        });

        function openModal() {
          var grid = document.getElementById("modal-grid");
          clr(grid);
          ALL_WIDGETS.forEach(function (w) {
            var item = el(
              "div",
              "modal-item" + (activeWidgets.indexOf(w.id) !== -1 ? " added" : ""),
            );
            item.appendChild(txt("div", "mi-name", w.label));
            item.appendChild(txt("div", "mi-desc", w.value + " â€” " + w.sub));
            if (activeWidgets.indexOf(w.id) === -1) {
              item.addEventListener("click", function () {
                addWidget(w.id);
                closeModal();
              });
            }
            grid.appendChild(item);
          });
          document.getElementById("modal-backdrop").classList.add("open");
        }
        function closeModal() {
          document.getElementById("modal-backdrop").classList.remove("open");
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD â€” PROJECTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildProjects() {
          var grid = document.getElementById("projects-grid");
          clr(grid);
          PROJECTS.forEach(function (p) {
            var card = el("div", "proj-card " + p.border);
            var top = el("div", "proj-top");
            top.appendChild(txt("span", "proj-icon", p.icon));
            top.appendChild(txt("span", "proj-name", p.name));
            var sLabel =
              p.status === "active" ? "Active" : p.status === "hold" ? "On Hold" : "Blocked";
            top.appendChild(txt("span", "proj-status " + p.status, sLabel));
            card.appendChild(top);

            var prog = el("div", "proj-progress");
            var bg = el("div", "prog-bar-bg");
            var fill = el("div", "prog-bar-fill");
            fill.style.width = Math.round((p.done / p.total) * 100) + "%";
            bg.appendChild(fill);
            prog.appendChild(bg);
            prog.appendChild(txt("div", "prog-label", p.done + " / " + p.total + " tasks done"));
            card.appendChild(prog);

            var tasks = el("div", "proj-tasks");
            p.tasks.forEach(function (t) {
              var row = el("div", "task-item");
              row.appendChild(el("span", "task-dot"));
              row.appendChild(txt("span", "", t));
              row.addEventListener("click", function (e) {
                e.stopPropagation();
                setContext(t);
              });
              tasks.appendChild(row);
            });
            card.appendChild(tasks);
            card.appendChild(txt("div", "proj-updated", "Updated 3h ago"));
            card.addEventListener("click", function () {
              setContext(p.name);
            });
            grid.appendChild(card);
          });
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD â€” QUICK HEALTH (mini)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildQuickHealth() {
          var container = document.getElementById("quick-health");
          clr(container);
          var wrap = el("div", "");
          wrap.style.cssText =
            "background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;";
          DBS.slice(0, 5).forEach(function (db) {
            var row = el("div", "db-full-row");
            row.appendChild(el("span", "db-dot " + db.status));
            row.appendChild(txt("span", "db-name", db.name));
            row.appendChild(txt("span", "db-rows", db.rows + " rows"));
            wrap.appendChild(row);
          });
          var more = el("div", "");
          more.style.cssText =
            "padding:8px 16px;font-family:var(--font-mono);font-size:10px;color:var(--text-3);cursor:pointer;";
          more.textContent = "+ 3 more databases â†’ view all";
          more.addEventListener("click", function () {
            showPage("health");
          });
          wrap.appendChild(more);
          container.appendChild(wrap);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD â€” DOCS ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildDocsRow() {
          var row = document.getElementById("docs-row");
          clr(row);
          DOCS_DATA.forEach(function (d) {
            var card = el("div", "doc-card");
            card.appendChild(txt("div", "doc-title", d.title));
            card.appendChild(
              txt("div", "doc-meta", d.source + " Â· " + d.words.toLocaleString() + " words"),
            );
            card.appendChild(txt("div", "doc-excerpt", d.excerpt));
            card.appendChild(txt("div", "doc-footer", "Edited: " + d.edited));
            card.addEventListener("click", function () {
              setContext(d.title);
            });
            row.appendChild(card);
          });
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEALTH PAGE â€” DB FULL LIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildDBFull() {
          var list = document.getElementById("db-full-list");
          clr(list);
          DBS.forEach(function (db) {
            var row = el("div", "db-full-row");
            row.appendChild(el("span", "db-dot " + db.status));
            row.appendChild(txt("span", "db-name", db.name));
            var rowsSpan = txt("span", "db-rows", db.rows.toLocaleString() + " rows");
            row.appendChild(rowsSpan);
            var pill = txt("span", "db-status-pill " + db.status, db.status);
            row.appendChild(pill);
            list.appendChild(row);
          });
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEALTH PAGE â€” SETUP CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildSetup() {
          var grid = document.getElementById("setup-grid");
          clr(grid);
          SETUP_CARDS.forEach(function (s) {
            var card = el("div", "setup-card");
            var head = el("div", "setup-card-head");
            head.appendChild(txt("span", "setup-icon", s.icon));
            head.appendChild(txt("span", "setup-name", s.name));
            head.appendChild(
              txt(
                "span",
                "setup-status-badge " + s.status,
                s.status === "connected" ? "â— connected" : "â—‹ not set",
              ),
            );
            card.appendChild(head);
            card.appendChild(txt("p", "setup-desc", s.desc));
            var btn = txt("button", "setup-action", s.action);
            card.appendChild(btn);
            grid.appendChild(card);
          });
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORKSPACES PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildWorkspaceSidebar() {
          var sb = document.getElementById("notion-sidebar");
          clr(sb);
          sb.appendChild(txt("div", "notion-tree-label", "Pages"));
          WORKSPACE_PAGES.forEach(function (p) {
            var item = el("div", "notion-tree-item");
            item.appendChild(txt("span", "ti", p.icon));
            item.appendChild(txt("span", "tl", p.name));
            item.dataset.tag = p.tag;
            item.addEventListener("click", function () {
              renderWorkspacePage(p);
              document.querySelectorAll(".notion-tree-item").forEach(function (i) {
                i.classList.remove("active");
              });
              item.classList.add("active");
            });
            sb.appendChild(item);
          });
          sb.querySelector(".notion-tree-item").classList.add("active");

          sb.appendChild(txt("div", "notion-tree-label", "Linked Databases"));
          DBS.slice(0, 4).forEach(function (db) {
            var item = el("div", "notion-tree-item");
            item.appendChild(txt("span", "ti", "ðŸ—„"));
            item.appendChild(txt("span", "tl", db.name));
            sb.appendChild(item);
          });
        }

        function renderWorkspacePage(p) {
          var content = document.getElementById("notion-page-content");
          clr(content);

          content.appendChild(txt("div", "notion-page-icon", p.icon));
          content.appendChild(txt("h1", "notion-page-title", p.name));
          content.appendChild(
            txt(
              "div",
              "notion-page-meta",
              "Last edited by Tulio Â· Today, 14:32 Â· in My Team Workspace",
            ),
          );

          if (p.tag === "start") {
            var callout = el("div", "notion-callout");
            callout.appendChild(txt("span", "callout-icon", "ðŸ’¡"));
            callout.appendChild(
              txt(
                "p",
                "",
                "Welcome to Mission Control. Use the left nav to switch between pages, databases, and system settings.",
              ),
            );
            content.appendChild(callout);
            content.appendChild(txt("div", "notion-block h2", "Quick Links"));
            ["Product Roadmap â†’", "Engineering Hub â†’", "Knowledge Base â†’"].forEach(function (lnk) {
              content.appendChild(txt("div", "notion-block", lnk));
            });
          } else if (p.tag === "roadmap") {
            content.appendChild(txt("div", "notion-block h2", "Linked Databases"));
            content.appendChild(
              txt(
                "div",
                "notion-block",
                "Connect your live Notion databases below. Linked databases mirror in real-time via the Notion API.",
              ),
            );
            var grid = el("div", "db-link-grid");
            DBS.slice(0, 4).forEach(function (db) {
              var card = el("div", "db-link-card");
              var head = el("div", "db-link-head");
              head.appendChild(txt("span", "db-link-icon", "ðŸ—„"));
              head.appendChild(txt("span", "db-link-name", db.name));
              card.appendChild(head);

              var linked = db.status === "healthy";
              var statusRow = el("div", "db-link-status");
              var dot = el("span", "dot" + (linked ? " linked" : ""));
              statusRow.appendChild(dot);
              statusRow.appendChild(txt("span", "", linked ? "Live mirror active" : "Not linked"));
              card.appendChild(statusRow);
              card.appendChild(txt("div", "db-link-rows", db.rows.toLocaleString() + " rows"));

              var toggleRow = el("div", "toggle-row");
              toggleRow.appendChild(txt("span", "toggle-label", "Mirror this database"));
              var tog = el("div", "toggle" + (linked ? " on" : ""));
              tog.addEventListener("click", function () {
                tog.classList.toggle("on");
              });
              toggleRow.appendChild(tog);
              card.appendChild(toggleRow);

              var btn = txt(
                "button",
                "db-link-btn" + (linked ? " linked" : ""),
                linked ? "âœ“ Linked" : "Link Database",
              );
              if (!linked) {
                btn.addEventListener("click", function () {
                  tog.classList.add("on");
                  btn.textContent = "âœ“ Linked";
                  btn.classList.add("linked");
                });
              }
              card.appendChild(btn);
              grid.appendChild(card);
            });
            content.appendChild(grid);
          } else {
            content.appendChild(txt("div", "notion-block h2", "Overview"));
            content.appendChild(
              txt(
                "div",
                "notion-block",
                "This page is part of your Mission Control workspace. Subpages and linked databases will appear here.",
              ),
            );
            var hr = el("hr", "notion-block divider");
            content.appendChild(hr);
            content.appendChild(txt("div", "notion-block h3", "Properties"));
            ["Owner: Tulio", "Status: Active", "Tags: workspace, team"].forEach(function (p) {
              content.appendChild(txt("div", "notion-block", p));
            });
          }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FEATURES PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildFeatures() {
          var list = document.getElementById("feat-list");
          clr(list);
          FEATURES.forEach(function (f) {
            var card = el("div", "feat-card");
            card.appendChild(txt("span", "feat-icon", f.icon));
            var info = el("div", "feat-info");
            info.appendChild(txt("div", "feat-name", f.name));
            info.appendChild(txt("div", "feat-desc", f.desc));
            info.appendChild(txt("div", "feat-tag", "#" + f.tag));
            card.appendChild(info);
            var tog = el("div", "toggle" + (f.on ? " on" : ""));
            tog.addEventListener("click", function () {
              tog.classList.toggle("on");
            });
            var tw = el("div", "feat-toggle");
            tw.appendChild(tog);
            card.appendChild(tw);
            list.appendChild(card);
          });
        }

        function buildAutomations() {
          var list = document.getElementById("auto-list");
          clr(list);
          AUTOMATIONS.forEach(function (a) {
            var card = el("div", "auto-card");
            var head = el("div", "auto-head");
            head.appendChild(txt("span", "auto-icon", a.icon));
            head.appendChild(txt("span", "auto-name", a.name));
            head.appendChild(txt("span", "auto-status " + a.status, a.status));
            card.appendChild(head);

            var rule = el("div", "auto-rule");
            var wSpan = el("span", "");
            wSpan.textContent = "WHEN ";
            var wVal = txt("span", "", a.when + " " + a.cond + " Â· THEN ");
            var tVal = txt("span", "", a.then);
            rule.appendChild(wSpan);
            rule.appendChild(wVal);
            rule.appendChild(tVal);
            card.appendChild(rule);
            card.appendChild(txt("div", "auto-meta", "â± " + a.runs));
            list.appendChild(card);
          });
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOCS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function buildDocsTree() {
          var tree = document.getElementById("docs-tree");
          clr(tree);
          DOCS_TREE.forEach(function (section) {
            tree.appendChild(txt("div", "docs-tree-section", section.label));
            section.items.forEach(function (doc) {
              var item = el("div", "docs-tree-item");
              item.appendChild(txt("span", "", "ðŸ“„"));
              item.appendChild(txt("span", "tl", doc.title));
              item.addEventListener("click", function () {
                document.querySelectorAll(".docs-tree-item").forEach(function (i) {
                  i.classList.remove("active");
                });
                item.classList.add("active");
                renderDocPage(doc);
              });
              tree.appendChild(item);
            });
          });
          tree.querySelector(".docs-tree-item").classList.add("active");
        }

        function renderDocPage(doc) {
          var content = document.getElementById("docs-content");
          clr(content);
          var body = doc.body && DOCS_BODIES[doc.body] ? DOCS_BODIES[doc.body] : null;
          var heading = body ? body.h : doc.title;

          content.appendChild(txt("div", "docs-doc-title", heading));
          var meta = el("div", "docs-doc-meta");
          meta.appendChild(txt("span", "", doc.words.toLocaleString() + " words"));
          meta.appendChild(txt("span", "", "Edited: " + doc.edited));
          content.appendChild(meta);

          var docBody = el("div", "docs-body");
          if (body) {
            body.paras.forEach(function (p) {
              docBody.appendChild(txt("p", "", p));
            });
          } else {
            docBody.appendChild(
              txt(
                "p",
                "",
                "This document is stored in your Notion workspace. Connect the Notion API to load live content here.",
              ),
            );
          }
          content.appendChild(docBody);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHAT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        var chatOpen = false;
        var chatPanel = document.getElementById("chat-panel");
        var chatMessages = document.getElementById("chat-messages");
        var chatInput = document.getElementById("chat-input");

        function toggleChat(open) {
          chatOpen = open !== undefined ? open : !chatOpen;
          chatPanel.classList.toggle("open", chatOpen);
        }
        document.getElementById("chat-tab").addEventListener("click", function () {
          toggleChat(true);
        });
        document.getElementById("chat-close").addEventListener("click", function () {
          toggleChat(false);
        });

        function setContext(name) {
          document.getElementById("chat-context-name").textContent = name;
          document.getElementById("chat-hint").textContent = "Chatting about: " + name;
          buildPrompts();
          toggleChat(true);
        }

        function buildPrompts() {
          var container = document.getElementById("chat-prompts");
          clr(container);
          var prompts = PAGE_PROMPTS[currentPage] || DEFAULT_PROMPTS;
          prompts.forEach(function (p) {
            var chip = el("div", "prompt-chip");
            chip.textContent = p;
            chip.addEventListener("click", function () {
              sendMsg(p);
            });
            container.appendChild(chip);
          });
        }

        /* â”€â”€ COMMAND PALETTE FUNCTIONS â”€â”€ */
        var cmdPaletteEl = null; // lazy-init after DOM ready
        function getCmdPalette() {
          if (!cmdPaletteEl) cmdPaletteEl = document.getElementById("cmd-palette");
          return cmdPaletteEl;
        }

        function showCommandPalette(filter) {
          var pal = getCmdPalette();
          clr(pal);
          var term = (filter || "").toLowerCase();
          var matches = SLASH_COMMANDS.filter(function (c) {
            return !term || c.name.indexOf(term) === 0;
          });
          if (matches.length === 0) {
            hideCommandPalette();
            return;
          }
          matches.forEach(function (c, i) {
            var item = el("div", "cmd-palette-item");
            if (i === 0) item.classList.add("active");
            var nameSpan = el("span", "cmd-name");
            nameSpan.textContent = "/" + c.name;
            var descSpan = el("span", "cmd-desc");
            descSpan.textContent = c.desc;
            item.appendChild(nameSpan);
            item.appendChild(descSpan);
            item.dataset.cmd = c.name;
            item.addEventListener("click", function () {
              chatInput.value = "";
              hideCommandPalette();
              executeSlashCommand(c.name);
            });
            pal.appendChild(item);
          });
          paletteIndex = 0;
          pal.classList.add("visible");
        }

        function hideCommandPalette() {
          var pal = getCmdPalette();
          pal.classList.remove("visible");
          paletteIndex = -1;
        }

        function isPaletteVisible() {
          var pal = getCmdPalette();
          return pal.classList.contains("visible");
        }

        function updatePaletteHighlight(newIndex) {
          var pal = getCmdPalette();
          var items = pal.querySelectorAll(".cmd-palette-item");
          if (items.length === 0) return;
          newIndex = ((newIndex % items.length) + items.length) % items.length;
          items.forEach(function (it) {
            it.classList.remove("active");
          });
          items[newIndex].classList.add("active");
          items[newIndex].scrollIntoView({ block: "nearest" });
          paletteIndex = newIndex;
        }

        function executeSlashCommand(name) {
          var cmd = SLASH_COMMANDS.find(function (c) {
            return c.name === name;
          });
          if (!cmd) return;
          var response = cmd.handler();
          /* Show the command as user message, response as AI */
          var userBubble = el("div", "msg-bubble user");
          userBubble.textContent = "/" + name;
          chatMessages.appendChild(userBubble);
          var aiBubble = el("div", "msg-bubble ai");
          aiBubble.textContent = response;
          chatMessages.appendChild(aiBubble);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        /* Widget commands via chat */
        var WIDGET_COMMANDS = {
          "total pages": "total-pages",
          "open tasks": "open-tasks",
          tasks: "open-tasks",
          docs: "docs",
          health: "health",
          databases: "databases",
          team: "team",
          automations: "automations",
          synced: "synced-today",
          "synced today": "synced-today",
        };

        /* â”€â”€ SLASH COMMANDS â”€â”€ */
        var SLASH_COMMANDS = [
          {
            name: "status",
            desc: "Show workspace status summary",
            handler: function () {
              return "ðŸ“Š Workspace Status\n\nâ€¢ 24 total pages across 3 workspaces\nâ€¢ 7 open tasks (2 high priority)\nâ€¢ Last synced: just now\nâ€¢ Health: all systems nominal";
            },
          },
          {
            name: "health",
            desc: "Show system health overview",
            handler: function () {
              return "ðŸŸ¢ System Health\n\nâ€¢ API: connected (42ms)\nâ€¢ Database: 3 sources online\nâ€¢ Automations: 5/5 running\nâ€¢ Memory: 68% utilized\nâ€¢ Uptime: 99.97%";
            },
          },
          {
            name: "logs",
            desc: "Show recent activity log",
            handler: function () {
              return 'ðŸ“‹ Recent Activity\n\nâ€¢ Page "Q1 Roadmap" edited â€” 3m ago\nâ€¢ Task "Fix auth bug" completed â€” 12m ago\nâ€¢ Database "Contacts" synced â€” 28m ago\nâ€¢ Automation "Daily digest" ran â€” 1h ago\nâ€¢ New comment on "Design Spec" â€” 2h ago';
            },
          },
          {
            name: "restart",
            desc: "Restart a service (simulated)",
            handler: function () {
              return "ðŸ”„ Restart initiatedâ€¦\n\nRestarting sync daemonâ€¦ done.\nRestarting webhook listenerâ€¦ done.\nAll services back online in 1.2s.";
            },
          },
          {
            name: "help",
            desc: "List all available commands",
            handler: function () {
              var lines = ["ðŸ“– Available Commands\n"];
              SLASH_COMMANDS.forEach(function (c) {
                lines.push("  /" + c.name + " â€” " + c.desc);
              });
              lines.push('\nYou can also say "add widget [name]" or "remove widget [name]".');
              return lines.join("\n");
            },
          },
          {
            name: "widgets",
            desc: "List dashboard widgets",
            handler: function () {
              var lines = ["ðŸ§© Dashboard Widgets\n"];
              ALL_WIDGETS.forEach(function (w) {
                var active = activeWidgets.indexOf(w.id) !== -1;
                lines.push("  " + (active ? "âœ“" : "â—‹") + " " + w.label);
              });
              return lines.join("\n");
            },
          },
          {
            name: "clear",
            desc: "Clear chat history",
            handler: function () {
              clr(document.getElementById("chat-messages"));
              return "ðŸ§¹ Chat cleared.";
            },
          },
        ];

        /* â”€â”€ PAGE-AWARE PROMPTS & CONTEXT â”€â”€ */
        var PAGE_PROMPTS = {
          dashboard: ["Summarize this project", "What's blocking this?", "Draft a status update"],
          workspaces: [
            "Compare these workspaces",
            "Which workspace needs attention?",
            "Show recent changes",
          ],
          docs: ["Summarize this document", "Find related docs", "Check for broken links"],
          databases: ["Show database stats", "Which tables are largest?", "Run a health check"],
          team: ["Who's most active?", "Show team workload", "Draft a team update"],
          clawdbot: ["Show ClawdBot status", "Recent conversations", "Check error rate"],
          tulsbot: ["Show Tulsbot status", "Check app health", "View recent logs"],
        };
        var DEFAULT_PROMPTS = [
          "Summarize this project",
          "What's blocking this?",
          "Draft a status update",
        ];

        var PAGE_CONTEXT_NAMES = {
          dashboard: "â—ˆ Mission Control",
          workspaces: "â—ˆ Workspaces",
          docs: "â—ˆ Docs",
          databases: "â—ˆ Databases",
          team: "â—ˆ Team",
          clawdbot: "â—ˆ ClawdBot",
        };

        var paletteIndex = -1;

        function handleChatCommand(text) {
          var lower = text.toLowerCase().trim();
          /* â”€â”€ Slash commands (/status, /help, etc.) â”€â”€ */
          if (lower.charAt(0) === "/") {
            var cmdName = lower.slice(1).split(/\s/)[0];
            var cmd = SLASH_COMMANDS.find(function (c) {
              return c.name === cmdName;
            });
            if (cmd) return cmd.handler();
            return 'Unknown command "/' + cmdName + '". Type /help for available commands.';
          }
          // "add widget X" or "add X"
          var addMatch = lower.match(/^add\s+(widget\s+)?(.+)$/);
          if (addMatch) {
            var query = addMatch[2].trim();
            var wid = WIDGET_COMMANDS[query];
            if (!wid) {
              // fuzzy: check if any key contains the query
              Object.keys(WIDGET_COMMANDS).forEach(function (k) {
                if (k.indexOf(query) !== -1 || query.indexOf(k) !== -1) wid = WIDGET_COMMANDS[k];
              });
            }
            if (wid) {
              var data = ALL_WIDGETS.find(function (w) {
                return w.id === wid;
              });
              if (data && activeWidgets.indexOf(wid) === -1) {
                addWidget(wid);
                return 'âœ“ Added "' + data.label + '" widget to your dashboard.';
              } else if (data) {
                return '"' + data.label + '" widget is already on your dashboard.';
              }
            }
            return "Widget not found. Try: total pages, open tasks, docs, health, databases, team, automations, synced today.";
          }
          // "remove widget X"
          var rmMatch = lower.match(/^remove\s+(widget\s+)?(.+)$/);
          if (rmMatch) {
            var query2 = rmMatch[2].trim();
            var wid2 = WIDGET_COMMANDS[query2];
            if (wid2 && activeWidgets.indexOf(wid2) !== -1) {
              var data2 = ALL_WIDGETS.find(function (w) {
                return w.id === wid2;
              });
              removeWidget(wid2);
              return 'âœ“ Removed "' + (data2 ? data2.label : wid2) + '" widget.';
            }
            return "Widget not found or not active.";
          }
          return null;
        }

        function sendMsg(text) {
          clr(document.getElementById("chat-prompts"));
          var userBubble = el("div", "msg-bubble user");
          userBubble.textContent = text;
          chatMessages.appendChild(userBubble);

          var aiBubble = el("div", "msg-bubble ai");
          aiBubble.textContent = "âŸ³ Thinkingâ€¦";
          chatMessages.appendChild(aiBubble);
          chatMessages.scrollTop = chatMessages.scrollHeight;

          setTimeout(function () {
            var cmd = handleChatCommand(text);
            if (cmd) {
              aiBubble.textContent = cmd;
            } else {
              aiBubble.textContent =
                'Connect the Notion API to get live answers. Try "add widget health" or "remove widget docs" to customize your dashboard.';
            }
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 600);
        }

        document.getElementById("chat-send").addEventListener("click", function () {
          var val = chatInput.value.trim();
          if (!val) return;
          chatInput.value = "";
          sendMsg(val);
        });
        chatInput.addEventListener("keydown", function (e) {
          if (isPaletteVisible()) {
            if (e.key === "ArrowDown") {
              e.preventDefault();
              updatePaletteHighlight(paletteIndex + 1);
              return;
            }
            if (e.key === "ArrowUp") {
              e.preventDefault();
              updatePaletteHighlight(paletteIndex - 1);
              return;
            }
            if (e.key === "Escape") {
              e.preventDefault();
              hideCommandPalette();
              return;
            }
            if (e.key === "Tab") {
              e.preventDefault();
              var items = getCmdPalette().querySelectorAll(".cmd-palette-item");
              if (items.length && paletteIndex >= 0) {
                chatInput.value = "/" + items[paletteIndex].dataset.cmd + " ";
              }
              hideCommandPalette();
              return;
            }
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              var items2 = getCmdPalette().querySelectorAll(".cmd-palette-item");
              if (items2.length && paletteIndex >= 0) {
                var cmdName = items2[paletteIndex].dataset.cmd;
                chatInput.value = "";
                hideCommandPalette();
                executeSlashCommand(cmdName);
              }
              return;
            }
          }
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            document.getElementById("chat-send").click();
          }
        });

        chatInput.addEventListener("input", function () {
          var val = chatInput.value;
          if (val.charAt(0) === "/") {
            showCommandPalette(val.slice(1));
          } else {
            hideCommandPalette();
          }
        });

        chatInput.addEventListener("blur", function () {
          /* Small delay so palette-item click registers before hiding */
          setTimeout(function () {
            hideCommandPalette();
          }, 150);
        });

        /* â”€â”€ SYNC BTN â”€â”€ */
        document.getElementById("btn-sync").addEventListener("click", function () {
          var lbl = document.getElementById("sync-label");
          var dot = document.querySelector(".sync-dot");
          lbl.textContent = "Syncingâ€¦";
          dot.classList.remove("ok");
          setTimeout(function () {
            lbl.textContent = "Synced just now";
            dot.classList.add("ok");
          }, 1200);
        });

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLAWDBOT CHAT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        function cbThinkingEl() {
          var wrap = el("div", "cb-thinking");
          var dots = el("div", "cb-thinking-dots");
          dots.appendChild(document.createElement("span"));
          dots.appendChild(document.createElement("span"));
          dots.appendChild(document.createElement("span"));
          wrap.appendChild(dots);
          var lbl = document.createElement("span");
          lbl.textContent = "Thinking\u2026";
          wrap.appendChild(lbl);
          return wrap;
        }

        function initClawdbot() {
          var input = document.getElementById("cb-input");
          var sendBtn = document.getElementById("cb-send");
          var chat = document.getElementById("cb-chat");
          if (!input || !sendBtn || !chat) return;

          input.addEventListener("input", function () {
            this.style.height = "auto";
            this.style.height = Math.min(this.scrollHeight, 150) + "px";
          });

          input.addEventListener("keydown", function (e) {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              cbSend(input, chat);
            }
          });

          sendBtn.addEventListener("click", function () {
            cbSend(input, chat);
          });
        }

        function cbSend(input, chat) {
          var text = input.value.trim();
          if (!text) return;

          var old = chat.querySelector(".cb-group:last-child .cb-thinking");
          if (old) old.closest(".cb-group").remove();

          var group = el("div", "cb-group user");
          var av = el("div", "cb-avatar user");
          av.textContent = "TF";
          var msgs = el("div", "cb-group-messages");
          var bubble = el("div", "cb-bubble fade-in");
          bubble.textContent = text;
          msgs.appendChild(bubble);
          group.appendChild(av);
          group.appendChild(msgs);
          chat.appendChild(group);

          input.value = "";
          input.style.height = "auto";
          chat.scrollTop = chat.scrollHeight;

          setTimeout(function () {
            var aGroup = el("div", "cb-group");
            var aAv = el("div", "cb-avatar assistant");
            aAv.textContent = "\u2B22";
            var aMsgs = el("div", "cb-group-messages");
            aMsgs.appendChild(cbThinkingEl());
            aGroup.appendChild(aAv);
            aGroup.appendChild(aMsgs);
            chat.appendChild(aGroup);
            chat.scrollTop = chat.scrollHeight;
          }, 400);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        buildWidgets();
        buildProjects();
        buildQuickHealth();
        buildDocsRow();
        buildDBFull();
        buildSetup();
        buildWorkspaceSidebar();
        buildFeatures();
        buildAutomations();
        buildDocsTree();
        renderDocPage(DOCS_TREE[0].items[0]);
        buildPrompts();
        initClawdbot();
      })();
    </script>
  </body>
</html>
